# AI 기반 TDD 에이전트 파이프라인: 역할 및 작업 흐름

**🎯 목표:** 테스트 주도 개발(TDD) 워크플로우의 각 단계를 전문화된 AI 에이전트에게 맡겨 **신규 기능 개발을 자동화**하고, **코드 품질**과 **개발 속도**를 향상시키는 것입니다. 🚀

---

## 핵심 아이디어

TDD의 복잡한 과정을 **명확한 역할**을 가진 여러 **AI 에이전트**로 분할하고, **Node.js 스크립트**를 사용하여 이 에이전트들을 순차적으로 호출하며 **데이터 흐름, 파일 시스템, Git 연동**까지 관리하는 **오케스트레이션(Orchestration)**을 구현합니다.

---

## 에이전트별 역할 🤖

1.  **기능 설계 에이전트 (1단계):**
    * **임무:** PRD + 코드를 분석 → **구현 질문 생성** → 개발자 답변 기반 → **최종 명세서 작성** (Markdown).
    * **산출물:** `output-02-feature-spec.md` (모든 단계의 기준).

2.  **테스트 설계 에이전트 (2단계):**
    * **임무:** 최종 명세서 기반 → **빈 테스트 셸** (`describe`, `it`) 생성/수정 (`src/__tests__/`).
    * **산출물:** 빈 테스트 케이스 파일 (RED 시작).

3.  **테스트 코드 작성 에이전트 (3단계):**
    * **임무:** 빈 테스트 셸 → **실제 테스트 로직** (Mocking, Assertion) 채우기.
    * **산출물:** 실패하는 테스트 코드 파일 (RED 완성).

4.  **코드 작성 에이전트 (4단계):**
    * **임무:** 실패하는 테스트 + 명세서 + 코드 컨텍스트 기반 → 테스트를 통과시키는 **기능 코드** 작성/수정 (`src/`).
    * **산출물:** 기능 구현 코드 (GREEN 목표).

5.  **코드 리뷰 에이전트 (4.5단계):**
    * **임무:** 4단계 코드가 규칙(타입, 스타일, Import)을 준수하는지 **자동 검토 및 수정**.
    * **산출물:** 규칙 준수 코드 + 리뷰 로그 (`code-review-log.md`).

6.  **코드 수정 에이전트 (5단계 - 필요시):**
    * **임무:** 4.5단계 후에도 테스트 실패 시, **실패 로그**를 기반으로 코드 **자동 디버깅 및 수정**.
    * **산출물:** 테스트 통과 코드 (GREEN 달성).

7.  **UI 구현 에이전트 (6단계):**
    * **임무:** 명세서 + 완성된 로직 기반 → **UI 컴포넌트** 생성/수정.
    * **산출물:** 기능과 연결된 UI 코드.

8.  **리팩토링 에이전트 (7단계):**
    * **임무:** 테스트 통과(GREEN) 코드를 **개선** (가독성, 효율성).
    * **산출물:** 개선된 기능 코드 (REFACTOR).

---

## 작업 흐름 (Step-by-Step) 🚶➡️🏃

1.  **(준비)** `runAgent.js`, `agent_prompts.js` 준비. `src` 폴더는 TDD 시작 전 상태.
2.  **(1단계: 설계)**
    * `node 01-run-design-analysis.js` 실행 → AI 질문 생성 (`output-01-questions.txt`).
    * **🧑‍💻 개발자:** 질문 답변 작성 (`02-run-design-spec.js` 수정).
    * `node 02-run-design-spec.js` 실행 → 최종 명세서 생성 (`output-02-feature-spec.md`).
    * **🧑‍💻 개발자:** 최종 명세서 검토/확정.
3.  **(2단계: 테스트 설계 - RED 셸)**
    * `node 03-run-test-design.js` 실행 → 빈 테스트 셸 생성 및 커밋.
4.  **(3단계: 테스트 작성 - RED 로직)**
    * `node 04-run-test-write.js` 실행 → 테스트 로직 구현 및 커밋.
    * **🧑‍💻 개발자/스크립트:** `pnpm test ...` 실행 → **실패(RED) 확인** 및 로그 저장 (`test-failure-log.txt`).
5.  **(4단계: 코드 작성 + 리뷰 - GREEN)**
    * `node 05-run-code-write.js` 실행 → 코드 작성 → 자동 리뷰/수정 → 커밋.
6.  **(5단계: 검증 및 수정 - 필요시)**
    * **🧑‍💻 개발자/스크립트:** `pnpm test` 실행.
    * **❌ 실패 시:**
        * 실패 로그 저장 (`pnpm test > ...`).
        * `node 06-run-code-fix.js` 실행 → 코드 자동 수정 및 커밋.
        * 다시 `pnpm test` 실행하여 **통과(GREEN) 🟢** 확인될 때까지 반복.
    * **✅ 통과 시:** 다음 단계로.
7.  **(6단계: UI 구현)**
    * `node 06-run-ui-implementation.js` 실행 → UI 컴포넌트 생성/수정 및 커밋.
    * **🧑‍💻 개발자:** 실제 화면 구동하여 UI 검증.
8.  **(7단계: 리팩토링)**
    * `node 07-run-refactor.js` 실행 → 코드 개선 및 커밋.
    * **🧑‍💻 개발자:** `pnpm test` 실행 → **테스트 여전히 통과 확인**.

---

## 핵심 장점 ✨

* **TDD 준수:** Red-Green-Refactor 사이클을 명확히 따릅니다.
* **역할 분담:** 각 AI 에이전트가 특정 작업에 집중하여 정확도를 높입니다.
* **자동화:** 스크립트를 통한 오케스트레이션으로 반복 작업을 자동화하고 Git 커밋으로 과정을 기록합니다.
* **제어 가능성:** Node.js 스크립트를 통해 컨텍스트 전달, 에러 처리, 외부 도구 연동 등을 정밀하게 제어합니다.
* **품질 향상:** 코드 리뷰 및 리팩토링 단계를 통해 코드 품질을 높입니다.